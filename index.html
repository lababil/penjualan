<!-- Firebase & Auth Scripts -->
<script type="module" src="js/firebase.js"></script>
<script type="module" src="js/auth.js"></script>

<!-- Login Handler -->
<script type="module">
  // Tunggu DOM siap
  document.addEventListener('DOMContentLoaded', async () => {
    const form = document.getElementById('loginForm');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const loginButton = document.getElementById('loginButton');
    const buttonText = document.getElementById('buttonText');
    const loadingSpinner = document.getElementById('loadingSpinner');

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault(); // ⚠️ Ini penting: hentikan submit default

      // Ambil nilai dari form
      const email = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      // Validasi dasar
      if (!email || !password) {
        showError('Email dan password wajib diisi.');
        return;
      }

      // Mulai loading
      loginButton.disabled = true;
      buttonText.textContent = 'Signing in...';
      loadingSpinner.classList.remove('hidden');

      try {
        // Gunakan Firebase Auth melalui window.auth
        const result = await window.auth.signIn(email, password);

        if (result.success) {
          showSuccess('Login berhasil! Mengarahkan...');
          // Redirect otomatis sudah ditangani oleh auth.js
        } else {
          showError(result.error || 'Login gagal. Silakan coba lagi.');
        }
      } catch (err) {
        console.error('Login error:', err);
        showError('Terjadi kesalahan sistem. Silakan coba lagi.');
      } finally {
        // Hentikan loading
        loginButton.disabled = false;
        buttonText.textContent = 'Sign In';
        loadingSpinner.classList.add('hidden');
      }
    });

    function showError(message) {
      errorMessage.querySelector('div.text-red-800').textContent = message;
      errorMessage.classList.remove('hidden');
      successMessage.classList.add('hidden');
    }

    function showSuccess(message) {
      successMessage.querySelector('div.text-green-800').textContent = message;
      successMessage.classList.remove('hidden');
      errorMessage.classList.add('hidden');
    }
  });
</script>

<!-- Theme Toggle Script (tetap di luar module) -->
<script>
  function toggleTheme() {
    const body = document.body;
    const isDark = body.classList.toggle('dark');
    const sunIcon = document.getElementById('sunIcon');
    const moonIcon = document.getElementById('moonIcon');
    
    if (isDark) {
      sunIcon.classList.add('hidden');
      moonIcon.classList.remove('hidden');
      localStorage.setItem('theme', 'dark');
    } else {
      sunIcon.classList.remove('hidden');
      moonIcon.classList.add('hidden');
      localStorage.setItem('theme', 'light');
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    if (savedTheme === 'dark') {
      document.body.classList.add('dark');
      document.getElementById('sunIcon').classList.add('hidden');
      document.getElementById('moonIcon').classList.remove('hidden');
    }
  });
</script>
